@{
    ViewData["Title"] = "FAQ Management";
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <style>
        .app-content-header {
            background: linear-gradient(45deg, #1f1f2e, #2c2c3d);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            color: #fff;
            border-radius: 0.5rem;
        }
    </style>
}

<div class="app-content-header">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h3 class="mb-0">FAQ Management</h3>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/Admin/Dashboard">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">FAQs</li>
                </ol>
            </nav>
        </div>
    </div>
</div>

<div class="app-content">
    <div class="container-fluid">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Frequently Asked Questions</h5>
                <a asp-action="Create" class="btn btn-primary"><i class="bi bi-plus-lg me-1"></i> Add FAQ</a>
            </div>
            <div class="card-body">
                <table id="faqs" class="table table-striped table-hover table-bordered nowrap" style="width:100%">
                    <thead class="table-light">
                        <tr>
                            <th>Question</th>
                            <th>Category</th>
                            <th>Order</th>
                            <th>Status</th>
                            <th>Created Date</th>
                            <th style="width: 250px;">Actions</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- ADD JQUERY FIRST -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>
        $(document).ready(function () {
            var faqsTable = $('#faqs').DataTable({
                processing: true,
                serverSide: true,
                responsive: true,
                lengthChange: true,
                autoWidth: false,
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, 'All']],
                ajax: {
                    url: "/Admin/FAQ/GetFAQsJson",
                    type: "POST",
                    contentType: "application/json",
                    dataType: "json",
                    data: function (d) {
                        return JSON.stringify({
                            draw: d.draw,
                            start: d.start,
                            length: d.length,
                            search: { value: d.search.value, regex: d.search.regex },
                            order: d.order.map(function (item) {
                                return { column: item.column, dir: item.dir };
                            })
                        });
                    }
                },
                columns: [
                    { data: "question", name: "Question" },
                    { data: "category", name: "Category" },
                    { data: "displayOrder", name: "DisplayOrder" },
                    {
                        data: "isActive",
                        name: "IsActive",
                        render: function(data) {
                            return data ?
                                '<span class="badge bg-success">Active</span>' :
                                '<span class="badge bg-secondary">Inactive</span>';
                        }
                    },
                    { data: "createdDate", name: "CreatedDate" },
                    { data: "actions", name: "Actions", orderable: false }
                ]
            });

            if ('@TempData["SuccessMessage"]' !== '') {
                toastr.success('@TempData["SuccessMessage"]');
                faqsTable.ajax.reload(null, false);
            }

            if ('@TempData["ErrorMessage"]' !== '') {
                toastr.error('@TempData["ErrorMessage"]');
            }
        });

        function toggleFAQStatus(id) {
            if (confirm('Are you sure you want to change the status of this FAQ?')) {
                $.post('/Admin/FAQ/ToggleStatus', { id: id })
                    .done(function() {
                        toastr.success('FAQ status updated successfully');
                        $('#faqs').DataTable().ajax.reload(null, false);
                    })
                    .fail(function() {
                        toastr.error('Error updating FAQ status');
                    });
            }
        }

        function confirmDelete(id) {
            if (confirm('Are you sure you want to delete this FAQ? This action cannot be undone.')) {
                $.post('/Admin/FAQ/Delete', { id: id })
                    .done(function() {
                        toastr.success('FAQ deleted successfully');
                        $('#faqs').DataTable().ajax.reload(null, false);
                    })
                    .fail(function() {
                        toastr.error('Error deleting FAQ');
                    });
            }
        }
    </script>
}